<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.tailwindcss.com"></script>
    <title>AI Music Studio</title>
</head>
<body class="bg-black text-white flex items-center justify-center min-h-screen">
    <div class="w-full max-w-md p-6 bg-gray-900 rounded-2xl shadow-xl">
        <h1 class="text-3xl font-bold text-center mb-6 text-blue-500">Songify Web</h1>
        <input id="prompt" type="text" placeholder="Enter song topic..." class="w-full p-4 rounded-lg bg-gray-800 mb-4 outline-none border border-gray-700 focus:border-blue-500">
        <button onclick="start()" id="btn" class="w-full bg-blue-600 py-4 rounded-lg font-bold hover:bg-blue-700 transition">Create Music</button>

        <div id="loader" class="mt-8 hidden">
            <div class="flex justify-between mb-2">
                <span id="stext" class="text-sm text-gray-400">Processing...</span>
                <span id="ptext" class="text-sm text-blue-500">0%</span>
            </div>
            <div class="w-full bg-gray-800 rounded-full h-2">
                <div id="pbar" class="bg-blue-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>
        <div id="result" class="mt-6"></div>
    </div>

    <script>
        async function start() {
            const prompt = document.getElementById('prompt').value;
            const btn = document.getElementById('btn');
            if(!prompt) return;

            btn.disabled = true;
            document.getElementById('loader').classList.remove('hidden');

            const form = new FormData();
            form.append('prompt', prompt);
            const res = await fetch('/generate', { method: 'POST', body: form });
            const { job_id } = await res.json();

            const poller = setInterval(async () => {
                const s = await fetch('/status/' + job_id);
                const data = await s.json();
                
                document.getElementById('pbar').style.width = data.progress + '%';
                document.getElementById('ptext').innerText = data.progress + '%';
                document.getElementById('stext').innerText = data.status;

                if (data.progress === 100) {
                    clearInterval(poller);
                    document.getElementById('result').innerHTML = `<audio controls class="w-full"><source src="${data.audio}"></audio>`;
                    btn.disabled = false;
                }
            }, 3000);
        }
    </script>
</body>
  </html>
